<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MineSweeper - Simulators Manager</title>
    <script src="jquery-2.1.4.min.js" type="text/javascript"></script>
    <style type="text/css">
        * {
            padding: 0;
            margin: 0;
            font-family: Consolas;
            border-spacing: 0;
        }

        body { background-color: #efefef; }

        #cmdWrapper {
            display: inline-block;
            background-color: #c0c0c0;
            margin: 5px;
            padding: 5px;
        }

        .cmd {
            display: inline-block;
            float: left;
            text-align: center;
            width: 30px;
            height: 30px;
            line-height: 30px;
            margin: 5px 5px 5px 5px;
            padding: 5px 5px 5px 5px;
            cursor: pointer;
        }

        #cmdOKWrapper { color: #f5302a; }

        table { table-layout: fixed; }

        thead > tr { background-color: #b0b0b0; }

        tr:nth-child(even) { background-color: #d0d0d0; }
    </style>
</head>
<body>
<h1>Simulators Manager</h1>
<form>
    <div id="cmdWrapper">
        <div id="cmdRef" class="cmd" style="background-color: #42df32">ref</div>
        <div id="cmdState" class="cmd" style="background-color: #42cd32">st.</div>
        <div id="cmdStart" class="cmd" style="background-color: #d2ed12">str</div>
        <div id="cmdLaunch" class="cmd" style="background-color: #f2f212">:la</div>
        <div id="cmdAuto" class="cmd" style="background-color: #f3c344">aut</div>
        <div id="cmdSave" class="cmd" style="background-color: #f4a460">:sa</div>
        <div id="cmdTerminate" class="cmd" style="background-color: #f5302a">tre</div>
        <div id="cmdOut" class="cmd" style="background-color: #6495ed">out</div>
        <div id="cmdDrop" class="cmd" style="background-color: #8050e0">dro</div>
        <br/>
        <div id="apWrapper"><input id="ap" type="text"/><input id="submit" type="button"/></div>
    </div>
    <div id="cmdOKWrapper">Command Sent, <span style="color: black">ref</span> to get result</div>
    <div style="width: 100%">
        <table>
            <colgroup>
                <col span="1" style="width: 20px" />
                <col span="1" style="width: 60px" />
                <col span="1" style=""/>
            </colgroup>
            <thead>
            <tr>
                <th></th>
                <td>ID</td>
                <td>Response</td>
            </tr>
            </thead>
            <tbody id="mainTableBody">
            </tbody>
        </table>
    </div>
</form>
<script type="text/javascript">
    var updateFrom = function (msg) {
        if ($('#mainTableBody tr').length === msg.length) {
            $.each(msg, function (i, item) {
                var tr = $('#mainTableBody tr')[i];
                $(tr).find('th input:checkbox').prop('checked', item.Checked);
                $(tr).find('td:eq(0)').text(item.ID);
                $(tr).find('td:eq(1)').html(item.Returns.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g, '$1<br/>$2'));
            });
        } else {
            $('#mainTableBody tr').remove();
            $.each(msg, function (i, item) {
                var box = $('<input type="checkbox"/>')
                    .prop('checked', item.Checked)
                    .change(function () {
                        $.ajax(
                        {
                            method: "POST",
                            url: "/check",
                            data: JSON.stringify({ 'Checked': box.prop('checked'), 'ID': item.ID }),
                            contentType: "application/json",
                            success: updateFrom
                        });
                    });
                $('<tr>').append(
                    $('<th>').append(box),
                    $('<td>').text(item.ID),
                    $('<td>').html(item.Returns.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g, '$1<br/>$2'))
                ).appendTo('#mainTableBody');
            });
        }
    };
    var updateAjax = function () {
        $.ajax(
        {
            method: "POST",
            url: "/",
            success: updateFrom
        });
    };
    var indicateCommandSucceed = function () {
        $('#cmdOKWrapper').css('opacity', 1).animate({
            opacity: 0
        }, 2000);
    }
    var sendCommand = function (cmd) {
        $.ajax(
        {
            method: "POST",
            url: "/command",
            data: cmd,
            contentType: "text/plain",
            success: indicateCommandSucceed
        });
    };

    $('#cmdRef').click(function () {
        $('#apWrapper').hide();
        updateAjax();
    });
    $('#cmdState').click(function () {
        $('#apWrapper').hide();
        sendCommand("state");
    });
    $('#cmdStart').click(function () {
        $('#apWrapper').hide();
        sendCommand("start");
    });
    $('#cmdLaunch').click(function () {
        $('#apWrapper').show();
        $('#ap').val(':launch 12 ').focus();
        $('#submit').val('launch');
        $('#submit').click(function (e) {
            $('#apWrapper').hide();
            sendCommand($('#ap').val());
        });
    });
    $('#cmdAuto').click(function () {
        $('#apWrapper').show();
        $('#ap').val('auto').focus();
        $('#submit').val('auto');
        $('#submit').click(function (e) {
            $('#apWrapper').hide();
            sendCommand($('#ap').val());
        });
    });
    $('#cmdSave').click(function () {
        $('#apWrapper').hide();
        sendCommand(":save");
    });
    $('#cmdTerminate').click(function () {
        $('#apWrapper').hide();
        sendCommand("terminate");
    });
    $('#cmdOut').click(function () {
        $('#apWrapper').hide();
        sendCommand("out");
    });
    $('#cmdDrop').click(function () {
        $('#apWrapper').hide();
        sendCommand("drop");
    });

    $(document).ready(function () {
        $('#apWrapper').hide();
        $('#cmdOKWrapper').css('opacity', 0);
        updateAjax();
    });
</script>
</body>
</html>
